# LDAP

-------------------------------------------------------------------

Цель домашнего задания:

Научиться настраивать LDAP-сервер и подключать к нему LDAP-клиентов

-------------------------------------------------------------------

Описание домашнего задания:

1) Установить FreeIPA

2) Написать Ansible-playbook для конфигурации клиента

-------------------------------------------------------------------

Инструкция по выполнению домашнего задания:

Создаем 3 виртуальных машины с ОС CentOS 8:

`vagrant up`

------------------------------------------------------------------

1) Настройка FreeIPA-сервер ipa.otus.lan. Установим часовой пояс:

`timedatectl set-timezone Europe/Moscow`

- Установим утилиту chrony:

`yum install -y chrony`

`systemctl enable chronyd --now`

- Выключаем Firewall:

`systemctl stop firewalld`

`systemctl disable firewalld`

- Остановим Selinux:

`setenforce 0`

- Поменяем в файле /etc/selinux/config, параметр Selinux на disabled

- Для дальнейшей настройки FreeIPA нам потребуется, чтобы DNS-сервер хранил запись о нашем LDAP-сервере. В рамках данной домашней работы мы не будем настраивать отдельный DNS-сервер и просто добавим запись в файл /etc/hosts:

`192.168.56.10 ipa.otus.lan ipa`

- Установим модуль DL1:

`yum install -y @idm:DL1`

- Установим FreeIPA-сервер:

`yum install -y ipa-server`

- Запустим скрипт установки:

`ipa-server-install`

- Далее, нам потребуется указать параметры нашего LDAP-сервера, после ввода каждого параметра нажимаем Enter, если нас устраивает параметр, указанный в квадратных скобках, то можно сразу нажимать Enter:

![Image alt](https://github.com/NikPuskov/LDAP/blob/main/ldap0.JPG)

- Далее начнется процесс установки. Процесс установки занимает примерно 5 минут (иногда время может быть другим). Если мастер успешно выполнит настройку FreeIPA то в конце мы получим сообщение: `The ipa-server-install command was successful.`

- При вводе параметров установки мы вводили 2 пароля:

`Directory Manager password` — это пароль администратора сервера каталогов, У этого пользователя есть полный доступ к каталогу.

`IPA admin password` — пароль от пользователя FreeIPA admin

После успешной установки FreeIPA, проверим, что сервер Kerberos может выдать нам билет:

![Image alt](https://github.com/NikPuskov/LDAP/blob/main/ldap1.JPG)

- Для удаления полученного билета:

`kdestroy`

- Мы можем зайти в Web-интерфейс нашего FreeIPA-сервера, для этого на нашей хостовой машине нужно прописать следующую строку в файле Hosts `192.168.56.10 ipa.otus.lan`

--------------------------------------------------------------------

2) Конфигурация клиентов

- Настройка клиента похожа на настройку сервера. На хосте также нужно:

`Настроить синхронизацию времени и часовой пояс`

`Настроить (или отключить) firewall`

`Настроить (или отключить) SElinux`

`В файле hosts должна быть указана запись с FreeIPA-сервером и хостом`

- Хостов, которые требуется добавить к серверу может быть много, для упрощения нашей работы настройки будут выполняться с помощью Ansible.

---------------------------------------------------------------------

3) Проверка работы LDAP

- На сервере FreeIPA создадим пользователя и попробуем залогиниться клиенту.

- Авторизируемся на сервере:

`kinit admin`

Создадим пользователя otus-user:

![Image alt](https://github.com/NikPuskov/LDAP/blob/main/ldap2.JPG)

- На хосте client1 или client2 выполним команду:

![Image alt](https://github.com/NikPuskov/LDAP/blob/main/ldap3.JPG)

- Система запросит у нас пароль и попросит ввести новый пароль.

- На этом процесс добавления хостов к FreeIPA-серверу завершен.
